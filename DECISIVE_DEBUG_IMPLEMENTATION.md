# ã€æ±ºç€ç”¨ãƒ‡ãƒãƒƒã‚°ã€‘å®Ÿè£…å®Œäº†

## ðŸŽ¯ ç›®çš„

key="è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡" ã®scoreMapãŒ4ã«ãªã£ã¦ã„ã‚‹å•é¡Œã‚’ç‰¹å®šã—ã€ä¿®æ­£ã™ã‚‹ã€‚
CSVã§ã¯5ã€scoreMapã§ã¯4ã«ãªã£ã¦ã„ã‚‹åŽŸå› ã‚’è©³ç´°ãƒ­ã‚°ã§è§£æ˜Žã™ã‚‹ã€‚

---

## âœ… å®Ÿè£…å†…å®¹

### 1. ROW DEBUGãƒ­ã‚°ã®è¿½åŠ 

```javascript
if (isDebugTarget) {
    console.log("\n=== ROW DEBUG START ===");
    console.log("row raw:", row);
    console.log("colMap:", colMap);
    console.log("row.length:", row.length);
    console.log("colMap['ã‚¹ã‚³ã‚¢'] index:", colMap['ã‚¹ã‚³ã‚¢']);
    console.log("colMap['è©•ä¾¡'] index:", colMap['è©•ä¾¡']);
    console.log("row['ã‚¹ã‚³ã‚¢'] raw:", scoreRaw, "json:", JSON.stringify(scoreRaw));
    console.log("row['è©•ä¾¡'] raw:", hyokaText, "json:", JSON.stringify(hyokaText));
    console.log("computed score BEFORE SET:", score, "type:", typeof score);
    console.log("key:", key);
    console.log("=== ROW DEBUG END ===");
}
```

### 2. normalizeNumber()ã‚’ä½¿ç”¨

```javascript
// ===== ã€é‡è¦ã€‘ã‚¹ã‚³ã‚¢å¤‰æ›: normalizeNumber()ã‚’ä½¿ç”¨ =====
const score = normalizeNumber(scoreRaw);
```

**normalizeNumber()ã®å‡¦ç†**:
1. trim() - å‰å¾Œã®ç©ºç™½é™¤åŽ»
2. å…¨è§’â†’åŠè§’å¤‰æ› (`ï¼-ï¼™` â†’ `0-9`)
3. Number() - æ•°å€¤åŒ–
4. 1ã€œ5ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆç¯„å›²å¤–ã¯nullï¼‰

### 3. CSVãƒ‘ãƒ¼ã‚¹æƒ…å ±ã®å‡ºåŠ›

```javascript
console.log('\nðŸ“Š CSVãƒ˜ãƒƒãƒ€ãƒ¼è§£æž:');
console.log('  header:', header);
console.log('  header.length:', header.length);
console.log('  colMap:', colMap);
console.log('  ãƒ‡ãƒ¼ã‚¿è¡Œæ•°:', dataRows.length);
console.log('  æœ€åˆã®ãƒ‡ãƒ¼ã‚¿è¡Œ:', dataRows[0]);
```

### 4. é”æˆæ¡ä»¶ã®è‡ªå‹•åˆ¤å®š

```javascript
if (scoreMap.has(debugKey)) {
    const finalScore = scoreMap.get(debugKey);
    console.log(`âœ… scoreMap.get("${debugKey}") = ${finalScore} (type: ${typeof finalScore})`);
    if (finalScore === 5) {
        console.log('ðŸŽ‰ðŸŽ‰ðŸŽ‰ é”æˆæ¡ä»¶ã‚¯ãƒªã‚¢ï¼šã‚¹ã‚³ã‚¢ãŒ5ã§ã™ï¼ ðŸŽ‰ðŸŽ‰ðŸŽ‰');
    } else {
        console.error(`âŒ é”æˆæ¡ä»¶æœªé”æˆï¼šã‚¹ã‚³ã‚¢ãŒ ${finalScore} ã§ã™ï¼ˆæœŸå¾…å€¤: 5ï¼‰`);
    }
}
```

---

## ðŸ” æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›

### ã‚¹ãƒ†ãƒƒãƒ—1: CSVãƒ˜ãƒƒãƒ€ãƒ¼è§£æž

```
ðŸ“Š CSVãƒ˜ãƒƒãƒ€ãƒ¼è§£æž:
  header: ["è¨˜å…¥æ—¥", "åˆ©ç”¨è€…å", "ç®¡ç†ç•ªå·", "è©•ä¾¡å®Ÿæ–½è€…å", "è©•ä¾¡æœŸé–“é–‹å§‹", "è©•ä¾¡æœŸé–“çµ‚äº†", "ã‚«ãƒ†ã‚´ãƒª", "é …ç›®", "ã‚¹ã‚³ã‚¢", "è©•ä¾¡", "ãƒ¡ãƒ¢"]
  header.length: 11
  colMap: {è¨˜å…¥æ—¥: 0, åˆ©ç”¨è€…å: 1, ..., ã‚¹ã‚³ã‚¢: 8, è©•ä¾¡: 9, ãƒ¡ãƒ¢: 10}
  ãƒ‡ãƒ¼ã‚¿è¡Œæ•°: 22
  æœ€åˆã®ãƒ‡ãƒ¼ã‚¿è¡Œ: ["2026-02-18", "ãƒ†ã‚¹ãƒˆå¤ªéƒŽ", ...]
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ROW DEBUGï¼ˆå¯¾è±¡è¡Œï¼‰

```
=== ROW DEBUG START ===
row raw: ["2026-02-18", "ãƒ†ã‚¹ãƒˆå¤ªéƒŽ", "TEST001", "å±±ç”°èŠ±å­", "2026-02-01", "2026-02-15", "è·æ¥­ç”Ÿæ´»", "æ¬ å¸­ç­‰ã®é€£çµ¡", "5", "ã§ãã‚‹", ""]
colMap: {è¨˜å…¥æ—¥: 0, åˆ©ç”¨è€…å: 1, ..., ã‚¹ã‚³ã‚¢: 8, è©•ä¾¡: 9, ãƒ¡ãƒ¢: 10}
row.length: 11
colMap['ã‚¹ã‚³ã‚¢'] index: 8
colMap['è©•ä¾¡'] index: 9
row['ã‚¹ã‚³ã‚¢'] raw: 5 json: "5"
row['è©•ä¾¡'] raw: ã§ãã‚‹ json: "ã§ãã‚‹"
computed score BEFORE SET: 5 type: number
key: è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡
=== ROW DEBUG END ===
```

### ã‚¹ãƒ†ãƒƒãƒ—3: scoreMapç¢ºèª

```
ðŸ”ðŸ”ðŸ” [ç‰¹å®šã‚­ãƒ¼è¿½è·¡é–‹å§‹] ðŸ”ðŸ”ðŸ”
å¯¾è±¡ã‚­ãƒ¼: "è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡"
å¯¾è±¡ã‚­ãƒ¼(JSON): "è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡"
scoreMapã«å­˜åœ¨: true
âœ… scoreMap.get("è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡") = 5 (type: number)
ðŸŽ‰ðŸŽ‰ðŸŽ‰ é”æˆæ¡ä»¶ã‚¯ãƒªã‚¢ï¼šã‚¹ã‚³ã‚¢ãŒ5ã§ã™ï¼ ðŸŽ‰ðŸŽ‰ðŸŽ‰
```

---

## ðŸ› å•é¡Œã®ç‰¹å®šæ–¹æ³•

### ã‚±ãƒ¼ã‚¹1: row['ã‚¹ã‚³ã‚¢']ãŒ"4"ã«ãªã£ã¦ã„ã‚‹

**å‡ºåŠ›**:
```
row['ã‚¹ã‚³ã‚¢'] raw: 4 json: "4"
computed score BEFORE SET: 4 type: number
```

**åŽŸå› **: CSVãƒ‘ãƒ¼ã‚¹ã®å•é¡Œã€‚ã‚«ãƒ©ãƒ ãŒãšã‚Œã¦ã„ã‚‹ã€‚

**å¯¾å‡¦**: 
- `colMap['ã‚¹ã‚³ã‚¢']` ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç¢ºèª
- `header` ã®å†…å®¹ã‚’ç¢ºèª
- CSVå†…ã®ã‚«ãƒ©ãƒ é †åºã‚’ç¢ºèª
- å¼•ç”¨ç¬¦ã‚„ã‚«ãƒ³ãƒžã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å•é¡Œã‚’ç¢ºèª

### ã‚±ãƒ¼ã‚¹2: row['ã‚¹ã‚³ã‚¢']ãŒ"ã§ãã‚‹"ã«ãªã£ã¦ã„ã‚‹

**å‡ºåŠ›**:
```
row['ã‚¹ã‚³ã‚¢'] raw: ã§ãã‚‹ json: "ã§ãã‚‹"
computed score BEFORE SET: null type: object
```

**åŽŸå› **: ã‚«ãƒ©ãƒ ãƒžãƒƒãƒ”ãƒ³ã‚°ãŒé–“é•ã£ã¦ã„ã‚‹ã€‚ã€Œè©•ä¾¡ã€åˆ—ã‚’ã€Œã‚¹ã‚³ã‚¢ã€åˆ—ã¨ã—ã¦èª­ã‚“ã§ã„ã‚‹ã€‚

**å¯¾å‡¦**:
- `colMap` ã®å€¤ã‚’ç¢ºèª
- ãƒ˜ãƒƒãƒ€ãƒ¼ã®åˆ—åã‚’ç¢ºèª
- CSVãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã‚’ç¢ºèª

### ã‚±ãƒ¼ã‚¹3: computed scoreãŒnull

**å‡ºåŠ›**:
```
row['ã‚¹ã‚³ã‚¢'] raw: "" json: ""
computed score BEFORE SET: null type: object
```

**åŽŸå› **: ã‚¹ã‚³ã‚¢åˆ—ãŒç©ºã€ã¾ãŸã¯ç„¡åŠ¹ãªå€¤ã€‚

**å¯¾å‡¦**:
- CSVãƒ•ã‚¡ã‚¤ãƒ«ã®è©²å½“ã‚»ãƒ«ã‚’ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒŸã‚¹ã‚’ç¢ºèª

### ã‚±ãƒ¼ã‚¹4: é‡è¤‡ã‚­ãƒ¼ã§ä¸Šæ›¸ãã•ã‚Œã¦ã„ã‚‹

**å‡ºåŠ›**:
```
âš ï¸ é‡è¤‡ã‚­ãƒ¼æ¤œå‡º:
  key: "è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡"
  æ—§score: 5
  æ–°score: 4
  è¡Œç•ªå·: 15
```

**åŽŸå› **: åŒã˜é …ç›®ãŒè¤‡æ•°è¡Œå­˜åœ¨ã—ã€å¾Œã®è¡Œï¼ˆã‚¹ã‚³ã‚¢4ï¼‰ã§ä¸Šæ›¸ãã•ã‚Œã¦ã„ã‚‹ã€‚

**å¯¾å‡¦**:
- CSVãƒ•ã‚¡ã‚¤ãƒ«ã«é‡è¤‡è¡ŒãŒãªã„ã‹ç¢ºèª
- å¿…è¦ã«å¿œã˜ã¦ã€æœ€åˆã®å€¤ã‚’å„ªå…ˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã«å¤‰æ›´

---

## ðŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

### æº–å‚™

1. https://smilestep-code.github.io/assessment-app/ ã‚’é–‹ã
2. **Ctrl+Shift+R** ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
3. **F12** â†’ Console ã‚¿ãƒ–

### ãƒ†ã‚¹ãƒˆCSV

```csv
è¨˜å…¥æ—¥,åˆ©ç”¨è€…å,ç®¡ç†ç•ªå·,è©•ä¾¡å®Ÿæ–½è€…å,è©•ä¾¡æœŸé–“é–‹å§‹,è©•ä¾¡æœŸé–“çµ‚äº†,ã‚«ãƒ†ã‚´ãƒª,é …ç›®,ã‚¹ã‚³ã‚¢,è©•ä¾¡,ãƒ¡ãƒ¢
2026-02-18,ãƒ†ã‚¹ãƒˆå¤ªéƒŽ,TEST001,å±±ç”°èŠ±å­,2026-02-01,2026-02-15,è·æ¥­ç”Ÿæ´»,æ¬ å¸­ç­‰ã®é€£çµ¡,5,ã§ãã‚‹,æ­£å¸¸ã«é€£çµ¡ã§ãã‚‹
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

1. **CSVãƒ˜ãƒƒãƒ€ãƒ¼è§£æž**
   - `colMap['ã‚¹ã‚³ã‚¢']` ãŒæ­£ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ8ï¼‰
   - `colMap['è©•ä¾¡']` ãŒæ­£ã—ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ9ï¼‰

2. **ROW DEBUG**
   - `row['ã‚¹ã‚³ã‚¢'] raw: 5 json: "5"` âœ…
   - `row['è©•ä¾¡'] raw: ã§ãã‚‹ json: "ã§ãã‚‹"` âœ…
   - `computed score BEFORE SET: 5 type: number` âœ…

3. **scoreMapç¢ºèª**
   - `scoreMap.get("è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡") = 5` âœ…
   - `ðŸŽ‰ðŸŽ‰ðŸŽ‰ é”æˆæ¡ä»¶ã‚¯ãƒªã‚¢` âœ…

---

## ðŸ“‹ é”æˆæ¡ä»¶

### âœ… æ¡ä»¶1: row['ã‚¹ã‚³ã‚¢']ãŒ"5"ã¨å‡ºã‚‹

```
row['ã‚¹ã‚³ã‚¢'] raw: 5 json: "5"
```

### âœ… æ¡ä»¶2: computed score BEFORE SETãŒ5

```
computed score BEFORE SET: 5 type: number
```

### âœ… æ¡ä»¶3: scoreMap.get()ãŒ5

```
scoreMap.get("è·æ¥­ç”Ÿæ´»__æ¬ å¸­ç­‰ã®é€£çµ¡") = 5
ðŸŽ‰ðŸŽ‰ðŸŽ‰ é”æˆæ¡ä»¶ã‚¯ãƒªã‚¢ï¼šã‚¹ã‚³ã‚¢ãŒ5ã§ã™ï¼ ðŸŽ‰ðŸŽ‰ðŸŽ‰
```

---

## ðŸ”§ å®Ÿè£…ã®å¤‰æ›´ç‚¹

### å¤‰æ›´1: isDebugTargetã®åˆ¤å®šæ–¹æ³•

**Before**:
```javascript
const isDebugTarget = (categoryRaw && categoryRaw.includes('è·æ¥­ç”Ÿæ´»')) && 
                     (itemNameRaw && itemNameRaw.includes('æ¬ å¸­'));
```

**After**:
```javascript
const categoryNorm = normalizeString(categoryRaw);
const itemNorm = normalizeString(itemNameRaw);
const isDebugTarget = (categoryNorm === 'è·æ¥­ç”Ÿæ´»' && itemNorm === 'æ¬ å¸­ç­‰ã®é€£çµ¡');
```

**ç†ç”±**: æ­£è¦åŒ–å¾Œã®å€¤ã§å®Œå…¨ä¸€è‡´åˆ¤å®šã‚’è¡Œã†ã“ã¨ã§ã€èª¤æ¤œå‡ºã‚’é˜²ãã€‚

### å¤‰æ›´2: ã‚¹ã‚³ã‚¢å¤‰æ›æ–¹æ³•

**Before**:
```javascript
const scoreNormalized = String(scoreRaw || '').trim();
const scoreConverted = scoreNormalized.replace(/[ï¼-ï¼™]/g, s => 
    String.fromCharCode(s.charCodeAt(0) - 0xFEE0)
);
const scoreNumber = Number(scoreConverted);
const score = (!isNaN(scoreNumber) && scoreNumber >= 1 && scoreNumber <= 5) 
    ? scoreNumber 
    : null;
```

**After**:
```javascript
const score = normalizeNumber(scoreRaw);
```

**ç†ç”±**: normalizeNumber()é–¢æ•°ã‚’ä½¿ç”¨ã—ã€å‡¦ç†ã‚’çµ±ä¸€ã€‚ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“ã€‚

### å¤‰æ›´3: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®è©³ç´°åŒ–

**è¿½åŠ ãƒ­ã‚°**:
- CSVãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±
- colMapã®å†…å®¹
- rowå…¨ä½“ã®ãƒ€ãƒ³ãƒ—
- colMapã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- å„ã‚«ãƒ©ãƒ ã®ç”Ÿã®å€¤ã¨JSON.stringify()
- é”æˆæ¡ä»¶ã®è‡ªå‹•åˆ¤å®š

---

## ðŸ“ å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«

1. **js/assessment.js**
   - CSVãƒ˜ãƒƒãƒ€ãƒ¼è§£æžãƒ­ã‚°è¿½åŠ 
   - ROW DEBUGãƒ­ã‚°è¿½åŠ ï¼ˆrowå…¨ä½“ã€colMapã€å„ã‚«ãƒ©ãƒ ï¼‰
   - normalizeNumber()ã‚’ä½¿ç”¨
   - é”æˆæ¡ä»¶ã®è‡ªå‹•åˆ¤å®šè¿½åŠ 

2. **index.html**
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°: `?v=202602180120` â†’ `?v=202602180130`

---

## ðŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±

- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 202602180130
- **å¤‰æ›´å†…å®¹**: æ±ºç€ç”¨ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å®Ÿè£…
- **ã‚³ãƒŸãƒƒãƒˆ**: ï¼ˆæ¬¡ã®ã‚³ãƒŸãƒƒãƒˆã§ç¢ºå®šï¼‰
- **GitHub Pages**: https://smilestep-code.github.io/assessment-app/

---

## ðŸ’¡ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: scoreãŒ4ã®ã¾ã¾

1. **CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª**
   - ã‚¹ã‚³ã‚¢åˆ—ãŒæ­£ã—ã5ã«ãªã£ã¦ã„ã‚‹ã‹
   - ã‚«ãƒ©ãƒ ã®é †åºãŒæ­£ã—ã„ã‹
   - å¼•ç”¨ç¬¦ã‚„ã‚«ãƒ³ãƒžã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒæ­£ã—ã„ã‹

2. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèª**
   - `colMap['ã‚¹ã‚³ã‚¢']` ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
   - `row['ã‚¹ã‚³ã‚¢'] raw` ã®å€¤
   - é‡è¤‡ã‚­ãƒ¼è­¦å‘Šã®æœ‰ç„¡

3. **CSVæ§‹é€ ã‚’ç¢ºèª**
   - ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒæ­£ã—ã„ã‹
   - ãƒ‡ãƒ¼ã‚¿è¡Œã®åˆ—æ•°ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹
   - é€”ä¸­ã«ç©ºè¡ŒãŒãªã„ã‹

### å•é¡Œ: scoreãŒnull

1. **ã‚¹ã‚³ã‚¢åˆ—ã®å€¤ã‚’ç¢ºèª**
   - ç©ºç™½ã«ãªã£ã¦ã„ãªã„ã‹
   - 1ã€œ5ã®ç¯„å›²å¤–ã«ãªã£ã¦ã„ãªã„ã‹
   - æ•°å€¤ä»¥å¤–ã®æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹

2. **normalizeNumber()ã®å‹•ä½œç¢ºèª**
   - `row['ã‚¹ã‚³ã‚¢'] raw` ã®å€¤ã‚’ç¢ºèª
   - JSON.stringify()ã§ä¸å¯è¦–æ–‡å­—ã‚’ç¢ºèª

---

**ä½œæˆæ—¥**: 2026-02-18  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 202602180130  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Ÿè£…å®Œäº†ãƒ»ãƒ†ã‚¹ãƒˆå¾…ã¡

---

**é‡è¦**: å¿…ãš **Ctrl+Shift+R** ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰ç¢ºèªã—ã¦ãã ã•ã„ï¼
